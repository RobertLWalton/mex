// MEXAS Compile Test 13 Input
//
// File:	mexas_compile_test_13.mex
// Author:	Bob Walton (walton@acm.org)
// Date:	Mon Jan 20 01:40:38 AM EST 2025
//
// The authors have placed this program in the public
// domain; they make no warranty and accept no liability
// for this program.
// MEXAS Time Test

// Empty stack test
//
PUSHI 100
TEST_INSTRUCTION ADD  // stack too small
TEST_INSTRUCTION JMP  // immedC = 0
PUSHI "HELLO"
TEST_INSTRUCTION JMPGEQ 0 0 1 // invalid arg
TEST_INSTRUCTION JMP 100 0 1 // immedA too large
TEST_INSTRUCTION JMP 0 0 1000000 // immedC too large
PUSHI +INF
TEST_INSTRUCTION JMPCNT 0 0 1 1 // INF count
PUSHI 5
TEST_INSTRUCTION JMPCNT 0 0 1 // immedD <= 0
PUSHI 0
PUSHI +INF
PUSHI +INF
TEST_INSTRUCTION JMPGEQ 0 1 1 // invalid arg
PUSHI NAN
TEST_INSTRUCTION JMPGEQ 0 0 1 // invalid arg
TEST_INSTRUCTION JMPGEQ 0 4 1 // immedB is not 0 or 1
TEST_INSTRUCTION JMP [ 5 ] 0 0 1 // too big trace depth
TEST_INSTRUCTION PUSHS 100  // too big immedA
TEST_INSTRUCTION PUSHG  // no module
TEST_INSTRUCTION PUSHL 0 1  // immedB > lexical level
TEST_INSTRUCTION PUSHL 1000  // immedA > stack length

BEGF PUSH-POP-TEST ARG1 ARG2
    TEST_INSTRUCTION PUSHL 1000 1
        // fp[1] + immedA > stack length
    TEST_INSTRUCTION PUSHL 1000 0
        // fp[0] + immedA > ap[1]
    TEST_INSTRUCTION PUSHA 0 2  // immedB > p->level
    TEST_INSTRUCTION PUSHA 3 1  // immedA > fp[1]
    TEST_INSTRUCTION PUSHNARGS  // immedB == 0
    PUSHI 2.5
    TEST_INSTRUCTION PUSHV 0 2  // immedB > p->level
    TEST_INSTRUCTION PUSHV 0 1  // top not int >= 0
    TEST_INSTRUCTION POPS 10    // immedA > frame len
    TEST_INSTRUCTION DEL 10 0 1
        // immedA + immedC > frame length
    PUSHI "RESULT"
    RET 1
ENDF

PUSHI "VALUE 1"
PUSHI "VALUE 2"
CALL PUSH-POP-TEST 2 RESULT

PUSHI 10
PUSHI 20
TEST_INSTRUCTION VPUSH 1
TEST_INSTRUCTION VPOP 1
TEST_INSTRUCTION VSIZE 1

BEGF GET-SET-TEST
    PUSHI 1
    PUSHI 2
    TEST_INSTRUCTION GET 10 0 0
    TEST_INSTRUCTION GET 1 0 10
    TEST_INSTRUCTION GET 1 1 1
    TEST_INSTRUCTION GET 1 0 0
    PUSHOBJ 10 5
    PUSHI 1e10
    TEST_INSTRUCTION GET 1 0 0
    POP
    PUSHI TRUE
    TEST_INSTRUCTION GET 1 0 0
    POP
    TEST_INSTRUCTION GETI 10
    TEST_INSTRUCTION GETI 0
    PUSHI 5
    TEST_INSTRUCTION GETI 0 0 0 "foo"
    RET 0
ENDF

CALL GET-SET-TEST 0
